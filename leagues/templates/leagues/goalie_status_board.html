{% extends 'core/base.html' %}
{% load static %}

{% block title %}Goalie Status Board - DC Street Hockey{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'assets/css/goalie.css' %}">
{% endblock %}

{% block content %}
<div id="content-wrapper">
    <div id="content">
        <div class="container goalie-board">
            <div class="title">
                Goalie Status Board
            </div>

            <div class="status-summary">
                <h2>Upcoming Games Needing Goalies</h2>
                {% if sub_needed_count > 0 %}
                    <div class="sub-needed-alert">
                        ⚠️ {{ sub_needed_count }} game{{ sub_needed_count|pluralize }} need{{ sub_needed_count|pluralize:"s," }} a goalie sub
                    </div>
                {% else %}
                    <div class="sub-needed-alert none">
                        ✓ All games have goalies confirmed or assigned
                    </div>
                {% endif %}
            </div>

            {% for week_data in weeks_data %}
            <div class="week-section">
                <div class="week-header">
                    <h3>{{ week_data.week.date|date:"l, F j, Y" }}</h3>
                    <span class="division-badge">{{ week_data.week.division }}</span>
                </div>

                {% if week_data.matchups %}
                <table class="matchups-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Away Team</th>
                            <th>Away Goalie</th>
                            <th>Home Team</th>
                            <th>Home Goalie</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for match_data in week_data.matchups %}
                        <tr>
                            <td class="time-cell">{{ match_data.matchup.time|time:"g:i A" }}</td>
                            <td class="team-cell">{{ match_data.matchup.awayteam.team_name }}</td>
                            <td>
                                <div class="goalie-cell">
                                    <span class="goalie-name {% if match_data.away_goalie_info.is_sub %}is-sub{% endif %}">
                                        {% if match_data.away_goalie_info.goalie_name %}
                                            {{ match_data.away_goalie_info.goalie_name }}
                                            {% if match_data.away_goalie_info.is_sub %}<span class="sub-badge">Sub</span>{% endif %}
                                        {% else %}
                                            ---
                                        {% endif %}
                                    </span>
                                    <span class="status-badge {% if match_data.away_goalie_info.status == 1 %}confirmed{% elif match_data.away_goalie_info.status == 2 %}sub-needed{% else %}unconfirmed{% endif %}">
                                        {{ match_data.away_goalie_info.status_display }}
                                    </span>
                                </div>
                            </td>
                            <td class="team-cell">{{ match_data.matchup.hometeam.team_name }}</td>
                            <td>
                                <div class="goalie-cell">
                                    <span class="goalie-name {% if match_data.home_goalie_info.is_sub %}is-sub{% endif %}">
                                        {% if match_data.home_goalie_info.goalie_name %}
                                            {{ match_data.home_goalie_info.goalie_name }}
                                            {% if match_data.home_goalie_info.is_sub %}<span class="sub-badge">Sub</span>{% endif %}
                                        {% else %}
                                            ---
                                        {% endif %}
                                    </span>
                                    <span class="status-badge {% if match_data.home_goalie_info.status == 1 %}confirmed{% elif match_data.home_goalie_info.status == 2 %}sub-needed{% else %}unconfirmed{% endif %}">
                                        {{ match_data.home_goalie_info.status_display }}
                                    </span>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="no-matchups">No matchups scheduled for this week.</div>
                {% endif %}
            </div>
            {% empty %}
            <div class="no-matchups">
                <p>No upcoming games scheduled.</p>
            </div>
            {% endfor %}

            <div class="legend">
                <div class="legend-item">
                    <span class="status-badge confirmed">Confirmed</span>
                    <span>Goalie is confirmed for this game</span>
                </div>
                <div class="legend-item">
                    <span class="status-badge sub-needed">Sub Needed</span>
                    <span>Team needs a substitute goalie</span>
                </div>
                <div class="legend-item">
                    <span class="status-badge unconfirmed">Unconfirmed</span>
                    <span>Captain hasn't confirmed availability yet</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
